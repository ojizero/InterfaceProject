/*!
 * jquery oembed plugin
 *
 * Copyright (c) 2009 Richard Chamorro
 * Licensed under the MIT license
 * 
 * Orignal Author: Richard Chamorro 
 * Forked by Andrew Mee to Provide a slightly diffent kind of embedding 
 * experience
 */
!function(e){function t(e,r){return r=r?r:"",e?t(--e,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+r):r}function r(e,t){var r,a=e.apiendpoint,o="";a+=a.indexOf("?")<=0?"?":"&",a=a.replace("#","%23"),null===e.maxWidth||"undefined"!=typeof e.params.maxwidth&&null!==e.params.maxwidth||(e.params.maxwidth=e.maxWidth),null===e.maxHeight||"undefined"!=typeof e.params.maxheight&&null!==e.params.maxheight||(e.params.maxheight=e.maxHeight);for(r in e.params)r!=e.callbackparameter&&null!==e.params[r]&&(o+="&"+escape(r)+"="+e.params[r]);return a+="format="+e.format+"&url="+escape(t)+o,"json"!=e.dataType&&(a+="&"+e.callbackparameter+"=?"),a}function a(t,r,a){e("#jqoembeddata").data(r,t.code),l.beforeEmbed.call(a,t),l.onEmbed.call(a,t),l.afterEmbed.call(a,t)}function o(o,i,n){if(void 0!=e("#jqoembeddata").data(i)&&"iframe"!=n.embedtag.tag){var m={code:e("#jqoembeddata").data(i)};a(m,i,o)}else if(n.yql){var s=n.yql.from||"htmlstring",u=n.yql.url?n.yql.url(i):i,c="SELECT * FROM "+s+' WHERE url="'+u+'" and '+(/html/.test(s)?"xpath":"itemPath")+"='"+(n.yql.xpath||"/")+"'";"html"==s&&(c+=" and compat='html5'");var d=e.extend({url:"http://query.yahooapis.com/v1/public/yql",dataType:"jsonp",data:{q:c,format:"json",env:"store://datatables.org/alltableswithkeys",callback:"?"},success:function(t){var r;if(n.yql.xpath&&"//meta|//title|//link"==n.yql.xpath){var l={};null==t.query.results&&(t.query.results={meta:[]});for(var m=0,s=t.query.results.meta.length;s>m;m++){var c=t.query.results.meta[m].name||t.query.results.meta[m].property||null;null!=c&&(l[c.toLowerCase()]=t.query.results.meta[m].content)}if(l.hasOwnProperty("title")&&l.hasOwnProperty("og:title")||null!=t.query.results.title&&(l.title=t.query.results.title),!l.hasOwnProperty("og:image")&&t.query.results.hasOwnProperty("link"))for(var m=0,s=t.query.results.link.length;s>m;m++)t.query.results.link[m].hasOwnProperty("rel")&&"apple-touch-icon"==t.query.results.link[m].rel&&("/"==t.query.results.link[m].href.charAt(0)?l["og:image"]=u.match(/^(([a-z]+:)?(\/\/)?[^\/]+\/).*$/)[1]+t.query.results.link[m].href:l["og:image"]=t.query.results.link[m].href);r=n.yql.datareturn(l)}else r=n.yql.datareturn?n.yql.datareturn(t.query.results):t.query.results.result;if(r!==!1){var d=e.extend({},r);d.code=r,a(d,i,o)}},error:l.onError.call(o,i,n)},l.ajaxOptions||{});e.ajax(d)}else if(n.templateRegex)if(""!==n.embedtag.tag){var h=n.embedtag.flashvars||"",p=n.embedtag.tag||"embed",f=n.embedtag.width||"auto",g=(n.embedtag.nocache||0,n.embedtag.height||"auto"),b=i.replace(n.templateRegex,n.apiendpoint);n.nocache||(b+="&jqoemcache="+t(5)),n.apikey&&(b=b.replace("_APIKEY_",l.apikeys[n.name]));var y=e("<"+p+"/>").attr("src",b).attr("width",f).attr("height",g).attr("allowfullscreen",n.embedtag.allowfullscreen||"true").attr("allowscriptaccess",n.embedtag.allowfullscreen||"always").css("max-height",l.maxHeight||"auto").css("max-width",l.maxWidth||"auto");"embed"==p&&y.attr("type",n.embedtag.type||"application/x-shockwave-flash").attr("flashvars",i.replace(n.templateRegex,h)),"iframe"==p&&y.attr("scrolling",n.embedtag.scrolling||"no").attr("frameborder",n.embedtag.frameborder||"0");var m={code:y};a(m,i,o)}else if(n.apiendpoint)n.apikey&&(n.apiendpoint=n.apiendpoint.replace("_APIKEY_",l.apikeys[n.name])),d=e.extend({url:i.replace(n.templateRegex,n.apiendpoint),dataType:"jsonp",success:function(t){var r=e.extend({},t);r.code=n.templateData(t),a(r,i,o)},error:l.onError.call(o,i,n)},l.ajaxOptions||{}),e.ajax(d);else{var m={code:i.replace(n.templateRegex,n.template)};a(m,i,o)}else{var v=r(n,i),d=e.extend({url:v,dataType:n.dataType||"jsonp",success:function(t){var r=e.extend({},t);switch(r.type){case"file":case"photo":r.code=e.fn.oembed.getPhotoCode(i,r);break;case"video":case"rich":r.code=e.fn.oembed.getRichCode(i,r);break;default:r.code=e.fn.oembed.getGenericCode(i,r)}a(r,i,o)},error:l.onError.call(o,i,n)},l.ajaxOptions||{});e.ajax(d)}}function i(e){if(null===e)return null;var t,r={};for(t in e)null!==t&&(r[t.toLowerCase()]=e[t]);return r}e.fn.oembed=function(t,r,a){l=e.extend(!0,e.fn.oembed.defaults,r);var n=["0rz.tw","1link.in","1url.com","2.gp","2big.at","2tu.us","3.ly","307.to","4ms.me","4sq.com","4url.cc","6url.com","7.ly","a.gg","a.nf","aa.cx","abcurl.net","ad.vu","adf.ly","adjix.com","afx.cc","all.fuseurl.com","alturl.com","amzn.to","ar.gy","arst.ch","atu.ca","azc.cc","b23.ru","b2l.me","bacn.me","bcool.bz","binged.it","bit.ly","bizj.us","bloat.me","bravo.ly","bsa.ly","budurl.com","canurl.com","chilp.it","chzb.gr","cl.lk","cl.ly","clck.ru","cli.gs","cliccami.info","clickthru.ca","clop.in","conta.cc","cort.as","cot.ag","crks.me","ctvr.us","cutt.us","dai.ly","decenturl.com","dfl8.me","digbig.com","http://digg.com/[^/]+$","disq.us","dld.bz","dlvr.it","do.my","doiop.com","dopen.us","easyuri.com","easyurl.net","eepurl.com","eweri.com","fa.by","fav.me","fb.me","fbshare.me","ff.im","fff.to","fire.to","firsturl.de","firsturl.net","flic.kr","flq.us","fly2.ws","fon.gs","freak.to","fuseurl.com","fuzzy.to","fwd4.me","fwib.net","g.ro.lt","gizmo.do","gl.am","go.9nl.com","go.ign.com","go.usa.gov","goo.gl","goshrink.com","gurl.es","hex.io","hiderefer.com","hmm.ph","href.in","hsblinks.com","htxt.it","huff.to","hulu.com","hurl.me","hurl.ws","icanhaz.com","idek.net","ilix.in","is.gd","its.my","ix.lt","j.mp","jijr.com","kl.am","klck.me","korta.nu","krunchd.com","l9k.net","lat.ms","liip.to","liltext.com","linkbee.com","linkbun.ch","liurl.cn","ln-s.net","ln-s.ru","lnk.gd","lnk.ms","lnkd.in","lnkurl.com","lru.jp","lt.tl","lurl.no","macte.ch","mash.to","merky.de","migre.me","miniurl.com","minurl.fr","mke.me","moby.to","moourl.com","mrte.ch","myloc.me","myurl.in","n.pr","nbc.co","nblo.gs","nn.nf","not.my","notlong.com","nsfw.in","nutshellurl.com","nxy.in","nyti.ms","o-x.fr","oc1.us","om.ly","omf.gd","omoikane.net","on.cnn.com","on.mktw.net","onforb.es","orz.se","ow.ly","ping.fm","pli.gs","pnt.me","politi.co","post.ly","pp.gg","profile.to","ptiturl.com","pub.vitrue.com","qlnk.net","qte.me","qu.tc","qy.fi","r.ebay.com","r.im","rb6.me","read.bi","readthis.ca","reallytinyurl.com","redir.ec","redirects.ca","redirx.com","retwt.me","ri.ms","rickroll.it","riz.gd","rt.nu","ru.ly","rubyurl.com","rurl.org","rww.tw","s4c.in","s7y.us","safe.mn","sameurl.com","sdut.us","shar.es","shink.de","shorl.com","short.ie","short.to","shortlinks.co.uk","shorturl.com","shout.to","show.my","shrinkify.com","shrinkr.com","shrt.fr","shrt.st","shrten.com","shrunkin.com","simurl.com","slate.me","smallr.com","smsh.me","smurl.name","sn.im","snipr.com","snipurl.com","snurl.com","sp2.ro","spedr.com","srnk.net","srs.li","starturl.com","stks.co","su.pr","surl.co.uk","surl.hu","t.cn","t.co","t.lh.com","ta.gd","tbd.ly","tcrn.ch","tgr.me","tgr.ph","tighturl.com","tiniuri.com","tiny.cc","tiny.ly","tiny.pl","tinylink.in","tinyuri.ca","tinyurl.com","tk.","tl.gd","tmi.me","tnij.org","tnw.to","tny.com","to.ly","togoto.us","totc.us","toysr.us","tpm.ly","tr.im","tra.kz","trunc.it","twhub.com","twirl.at","twitclicks.com","twitterurl.net","twitterurl.org","twiturl.de","twurl.cc","twurl.nl","u.mavrev.com","u.nu","u76.org","ub0.cc","ulu.lu","updating.me","ur1.ca","url.az","url.co.uk","url.ie","url360.me","url4.eu","urlborg.com","urlbrief.com","urlcover.com","urlcut.com","urlenco.de","urli.nl","urls.im","urlshorteningservicefortwitter.com","urlx.ie","urlzen.com","usat.ly","use.my","vb.ly","vevo.ly","vgn.am","vl.am","vm.lc","w55.de","wapo.st","wapurl.co.uk","wipi.es","wp.me","x.vu","xr.com","xrl.in","xrl.us","xurl.es","xurl.jp","y.ahoo.it","yatuc.com","ye.pe","yep.it","yfrog.com","yhoo.it","yiyd.com","youtu.be","yuarel.com","z0p.de","zi.ma","zi.mu","zipmyurl.com","zud.me","zurl.ws","zz.gd","zzang.kr","›.ws","✩.ws","✿.ws","❥.ws","➔.ws","➞.ws","➡.ws","➨.ws","➯.ws","➹.ws","➽.ws"];return 0===e("#jqoembeddata").length&&e('<span id="jqoembeddata"></span>').appendTo("body"),this.each(function(){var r,m=e(this),s=!t||t.indexOf("http://")&&t.indexOf("https://")?m.attr("href"):t;if(a?l.onEmbed=a:l.onEmbed||(l.onEmbed=function(t){e.fn.oembed.insertCode(this,l.embedMethod,t)}),null!==s&&void 0!==s){for(var u=0,c=n.length;c>u;u++){var d=new RegExp("://"+n[u]+"/","i");if(null!==s.match(d)){var h=e.extend({url:"http://api.longurl.org/v2/expand",dataType:"jsonp",data:{url:s,format:"json"},success:function(t){s=t["long-url"],r=e.fn.oembed.getOEmbedProvider(t["long-url"]),null!==r?(r.params=i(l[r.name])||{},r.maxWidth=l.maxWidth,r.maxHeight=l.maxHeight,o(m,s,r)):l.onProviderNotFound.call(m,s)}},l.ajaxOptions||{});return e.ajax(h),m}}r=e.fn.oembed.getOEmbedProvider(s),null!==r?(r.params=i(l[r.name])||{},r.maxWidth=l.maxWidth,r.maxHeight=l.maxHeight,o(m,s,r)):l.onProviderNotFound.call(m,s)}return m})};var l;e.fn.oembed.defaults={maxWidth:null,maxHeight:null,includeHandle:!0,embedMethod:"auto",onProviderNotFound:function(){},beforeEmbed:function(){},afterEmbed:function(){},onEmbed:!1,onError:function(){},ajaxOptions:{}},e.fn.oembed.insertCode=function(t,r,a){if(null!==a)switch("auto"==r&&null!==t.attr("href")?r="append":"auto"==r&&(r="replace"),r){case"replace":t.replaceWith(a.code);break;case"fill":t.html(a.code);break;case"append":t.wrap('<div class="oembedall-container"></div>');var o=t.parent();l.includeHandle&&e('<span class="oembedall-closehide">&darr;</span>').insertBefore(t).click(function(){var t=encodeURIComponent(e(this).text());e(this).html("%E2%86%91"==t?"&darr;":"&uarr;"),e(this).parent().children().last().toggle()}),o.append("<br/>");try{a.code.clone().appendTo(o)}catch(i){o.append(a.code)}if(l.maxWidth){var n=o.parent().width();if(n<l.maxWidth){var m=e("iframe",o).width(),s=e("iframe",o).height(),u=m/n;e("iframe",o).width(m/u),e("iframe",o).height(s/u)}else l.maxWidth&&e("iframe",o).width(l.maxWidth),l.maxHeight&&e("iframe",o).height(l.maxHeight)}}},e.fn.oembed.getPhotoCode=function(e,t){var r,a=t.title?t.title:"";if(a+=t.author_name?" - "+t.author_name:"",a+=t.provider_name?" - "+t.provider_name:"",t.url)r='<div><a href="'+e+"\" target='_blank'><img src=\""+t.url+'" alt="'+a+'"/></a></div>';else if(t.thumbnail_url){var o=t.thumbnail_url.replace("_s","_b");r='<div><a href="'+e+"\" target='_blank'><img src=\""+o+'" alt="'+a+'"/></a></div>'}else r="<div>Error loading this picture</div>";return t.html&&(r+="<div>"+t.html+"</div>"),r},e.fn.oembed.getRichCode=function(e,t){var r=t.html;return r},e.fn.oembed.getGenericCode=function(e,t){var r=null!==t.title?t.title:e,a='<a href="'+e+'">'+r+"</a>";return t.html&&(a+="<div>"+t.html+"</div>"),a},e.fn.oembed.getOEmbedProvider=function(t){for(var r=0;r<e.fn.oembed.providers.length;r++)for(var a=0,o=e.fn.oembed.providers[r].urlschemes.length;o>a;a++){var i=new RegExp(e.fn.oembed.providers[r].urlschemes[a],"i");if(null!==t.match(i))return e.fn.oembed.providers[r]}return null},e.fn.oembed.OEmbedProvider=function(e,t,r,a,o){this.name=e,this.type=t,this.urlschemes=r,this.apiendpoint=a,this.maxWidth=500,this.maxHeight=400,o=o||{},o.useYQL&&("xml"==o.useYQL?o.yql={xpath:"//oembed/html",from:"xml",apiendpoint:this.apiendpoint,url:function(e){return this.apiendpoint+"?format=xml&url="+e},datareturn:function(e){return e.html.replace(/.*\[CDATA\[(.*)\]\]>$/,"$1")||""}}:o.yql={from:"json",apiendpoint:this.apiendpoint,url:function(e){return this.apiendpoint+"?format=json&url="+e},datareturn:function(e){return"video"!=e.json.type&&(e.json.url||e.json.thumbnail_url)?'<img src="'+(e.json.url||e.json.thumbnail_url)+'" />':e.json.html||""}},this.apiendpoint=null);for(var i in o)this[i]=o[i];this.format=this.format||"json",this.callbackparameter=this.callbackparameter||"callback",this.embedtag=this.embedtag||{tag:""}},e.fn.updateOEmbedProvider=function(t,r,a,o,i){for(var l=0;l<e.fn.oembed.providers.length;l++)if(e.fn.oembed.providers[l].name===t&&(null!==r&&(e.fn.oembed.providers[l].type=r),null!==a&&(e.fn.oembed.providers[l].urlschemes=a),null!==o&&(e.fn.oembed.providers[l].apiendpoint=o),null!==i)){e.fn.oembed.providers[l].extraSettings=i;for(var n in i)null!==n&&null!==i[n]&&(e.fn.oembed.providers[l][n]=i[n])}},e.fn.oembed.providers=[new e.fn.oembed.OEmbedProvider("youtube","video",["youtube\\.com/watch.+v=[\\w-]+&?","youtu\\.be/[\\w-]+","youtube.com/embed"],"http://www.youtube.com/embed/$1?wmode=transparent",{templateRegex:/.*(?:v\=|be\/|embed\/)([\w\-]+)&?.*/,embedtag:{tag:"iframe",width:"530",height:"349"}}),new e.fn.oembed.OEmbedProvider("opengraph","rich",[".*"],null,{yql:{xpath:"//meta|//title|//link",from:"html",datareturn:function(t){if(!t["og:title"]&&t.title&&t.description&&(t["og:title"]=t.title),!t["og:title"]&&!t.title)return!1;var r=e("<p/>");if(t["og:video"]){var a=e('<embed src="'+t["og:video"]+'"/>');a.attr("type",t["og:video:type"]||"application/x-shockwave-flash").css("max-height",l.maxHeight||"auto").css("max-width",l.maxWidth||"auto"),t["og:video:width"]&&a.attr("width",t["og:video:width"]),t["og:video:height"]&&a.attr("height",t["og:video:height"]),r.append(a)}else if(t["og:image"]){var o=e('<img src="'+t["og:image"]+'">');o.css("max-height",l.maxHeight||"auto").css("max-width",l.maxWidth||"auto"),t["og:image:width"]&&o.attr("width",t["og:image:width"]),t["og:image:height"]&&o.attr("height",t["og:image:height"]),r.append(o)}return t["og:title"]&&r.append("<b>"+t["og:title"]+"</b><br/>"),t["og:description"]?r.append(t["og:description"]+"<br/>"):t.description&&r.append(t.description+"<br/>"),r}}})]}(jQuery);

//This is needed for gravatar :(
String.prototype.md5=function(){var a=function(a,b){var c=(a&65535)+(b&65535);var d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535};var b=function(a,b){return a<<b|a>>>32-b};var c=function(c,d,e,f,g,h){return a(b(a(a(d,c),a(f,h)),g),e)};var d=function(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)};var e=function(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)};var f=function(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)};var g=function(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)};var h=function(b){var c,h,i,j,k,l=b.length;var m=1732584193;var n=-271733879;var o=-1732584194;var p=271733878;for(k=0;k<l;k+=16){c=m;h=n;i=o;j=p;m=d(m,n,o,p,b[k+0],7,-680876936);p=d(p,m,n,o,b[k+1],12,-389564586);o=d(o,p,m,n,b[k+2],17,606105819);n=d(n,o,p,m,b[k+3],22,-1044525330);m=d(m,n,o,p,b[k+4],7,-176418897);p=d(p,m,n,o,b[k+5],12,1200080426);o=d(o,p,m,n,b[k+6],17,-1473231341);n=d(n,o,p,m,b[k+7],22,-45705983);m=d(m,n,o,p,b[k+8],7,1770035416);p=d(p,m,n,o,b[k+9],12,-1958414417);o=d(o,p,m,n,b[k+10],17,-42063);n=d(n,o,p,m,b[k+11],22,-1990404162);m=d(m,n,o,p,b[k+12],7,1804603682);p=d(p,m,n,o,b[k+13],12,-40341101);o=d(o,p,m,n,b[k+14],17,-1502002290);n=d(n,o,p,m,b[k+15],22,1236535329);m=e(m,n,o,p,b[k+1],5,-165796510);p=e(p,m,n,o,b[k+6],9,-1069501632);o=e(o,p,m,n,b[k+11],14,643717713);n=e(n,o,p,m,b[k+0],20,-373897302);m=e(m,n,o,p,b[k+5],5,-701558691);p=e(p,m,n,o,b[k+10],9,38016083);o=e(o,p,m,n,b[k+15],14,-660478335);n=e(n,o,p,m,b[k+4],20,-405537848);m=e(m,n,o,p,b[k+9],5,568446438);p=e(p,m,n,o,b[k+14],9,-1019803690);o=e(o,p,m,n,b[k+3],14,-187363961);n=e(n,o,p,m,b[k+8],20,1163531501);m=e(m,n,o,p,b[k+13],5,-1444681467);p=e(p,m,n,o,b[k+2],9,-51403784);o=e(o,p,m,n,b[k+7],14,1735328473);n=e(n,o,p,m,b[k+12],20,-1926607734);m=f(m,n,o,p,b[k+5],4,-378558);p=f(p,m,n,o,b[k+8],11,-2022574463);o=f(o,p,m,n,b[k+11],16,1839030562);n=f(n,o,p,m,b[k+14],23,-35309556);m=f(m,n,o,p,b[k+1],4,-1530992060);p=f(p,m,n,o,b[k+4],11,1272893353);o=f(o,p,m,n,b[k+7],16,-155497632);n=f(n,o,p,m,b[k+10],23,-1094730640);m=f(m,n,o,p,b[k+13],4,681279174);p=f(p,m,n,o,b[k+0],11,-358537222);o=f(o,p,m,n,b[k+3],16,-722521979);n=f(n,o,p,m,b[k+6],23,76029189);m=f(m,n,o,p,b[k+9],4,-640364487);p=f(p,m,n,o,b[k+12],11,-421815835);o=f(o,p,m,n,b[k+15],16,530742520);n=f(n,o,p,m,b[k+2],23,-995338651);m=g(m,n,o,p,b[k+0],6,-198630844);p=g(p,m,n,o,b[k+7],10,1126891415);o=g(o,p,m,n,b[k+14],15,-1416354905);n=g(n,o,p,m,b[k+5],21,-57434055);m=g(m,n,o,p,b[k+12],6,1700485571);p=g(p,m,n,o,b[k+3],10,-1894986606);o=g(o,p,m,n,b[k+10],15,-1051523);n=g(n,o,p,m,b[k+1],21,-2054922799);m=g(m,n,o,p,b[k+8],6,1873313359);p=g(p,m,n,o,b[k+15],10,-30611744);o=g(o,p,m,n,b[k+6],15,-1560198380);n=g(n,o,p,m,b[k+13],21,1309151649);m=g(m,n,o,p,b[k+4],6,-145523070);p=g(p,m,n,o,b[k+11],10,-1120210379);o=g(o,p,m,n,b[k+2],15,718787259);n=g(n,o,p,m,b[k+9],21,-343485551);m=a(m,c);n=a(n,h);o=a(o,i);p=a(p,j)}return[m,n,o,p]};var i=function(a){var b="0123456789abcdef",c="",d,e=a.length*4;for(d=0;d<e;d++){c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15)}return c};var j=function(a){var b=(a.length+8>>6)+1;var c=[],d,e=b*16,f,g=a.length;for(d=0;d<e;d++){c.push(0)}for(f=0;f<g;f++){c[f>>2]|=(a.charCodeAt(f)&255)<<f%4*8}c[f>>2]|=128<<f%4*8;c[b*16-2]=g*8;return c};return i(h(j(this)))}